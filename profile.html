<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحة البيانات الشخصية</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>مرحبًا بك في صفحتك الشخصية</h1>
    </header>
    <main>
        <section>
            <h2>الصورة الشخصية</h2>
            <img src="صورتك الشخصية" alt="صورتك الشخصية" id="profileImage">
            <input type="file" accept="image/*" id="imageUpload">
        </section>
        <section>
            <h2>بياناتك الشخصية</h2>
            <label for="name">الاسم:</label>
            <input type="text" id="name">
            <label for="email">البريد الإلكتروني:</label>
            <input type="email" id="email" disabled>
            <!-- يمكنك إضافة المزيد من البيانات الشخصية حسب الحاجة -->
            <button id="saveChanges">حفظ التغييرات</button>
        </section>
        <a href="#" id="logout">تسجيل الخروج</a>
    </main>
    <footer>
        <p>&copy; ٢٠٢٤ خدمات البناء</p>
    </footer>

    <!-- Firebase SDK Script Tags -->
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
    apiKey: "AIzaSyB7YJhtaefEPc9NMzhTBjQC06WmSEja0xc",
    authDomain: "omran-16f44.firebaseapp.com",
    databaseURL: "https://omran-16f44-default-rtdb.firebaseio.com",
    projectId: "omran-16f44",
    storageBucket: "omran-16f44.appspot.com",
    messagingSenderId: "598982209417",
    appId: "1:598982209417:web:dc9cbddd485a1ea52bbb58"
  };
        firebase.initializeApp(firebaseConfig);

        const auth = firebase.auth();
        const firestore = firebase.firestore();

        // Get current user
        const currentUser = auth.currentUser;

        // Set user's profile data
        document.getElementById('name').value = currentUser.displayName || '';
        document.getElementById('email').value = currentUser.email || '';

        // Save changes button click event
        document.getElementById('saveChanges').addEventListener('click', () => {
            const name = document.getElementById('name').value;
            const image = document.getElementById('imageUpload').files[0];

            // Update user's display name
            currentUser.updateProfile({
                displayName: name
            }).then(() => {
                console.log("User profile updated successfully");

                // Upload image to storage (if provided)
                if (image) {
                    const storageRef = firebase.storage().ref();
                    const imageRef = storageRef.child(`profileImages/${currentUser.uid}/${image.name}`);

                    imageRef.put(image).then((snapshot) => {
                        console.log('Uploaded a blob or file!', snapshot);
                        snapshot.ref.getDownloadURL().then((downloadURL) => {
                            console.log('File available at', downloadURL);
                            // Update user's profile image URL
                            currentUser.updateProfile({
                                photoURL: downloadURL
                            }).then(() => {
                                console.log("User profile image URL updated successfully");
                                document.getElementById('profileImage').src = downloadURL;
                            }).catch((error) => {
                                console.error("Error updating user profile image URL:", error);
                            });
                        }).catch((error) => {
                            console.error("Error getting download URL:", error);
                        });
                    }).catch((error) => {
                        console.error("Error uploading image:", error);
                    });
                }
            }).catch((error) => {
                console.error("Error updating user profile:", error);
            });
        });

        // Logout button click event
        document.getElementById('logout').addEventListener('click', () => {
            auth.signOut().then(() => {
                // Sign-out successful
                console.log("User signed out successfully");
                window.location.href = 'login.html';
            }).catch((error) => {
                // An error happened
                console.error("Error signing out:", error);
            });
        });
    </script>
</body>
</html>
