<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحة البيانات الشخصية</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>مرحبًا بك في صفحتك الشخصية</h1>
    </header>
    <main>
        <section>
            <h2>الصورة الشخصية</h2>
            <img src="صورتك الشخصية" alt="صورتك الشخصية" id="profileImage">
            <input type="file" accept="image/*" id="imageUpload">
        </section>
        <section>
            <h2>بياناتك الشخصية</h2>
            <label for="name">الاسم:</label>
            <input type="text" id="name">
            <label for="email">البريد الإلكتروني:</label>
            <input type="email" id="email" disabled>
            <label for="nationality">الجنسية:</label>
            <input type="text" id="nationality">
            <label for="city">المدينة:</label>
            <input type="text" id="city">
            <label for="experience">عدد سنوات الخبرة:</label>
            <input type="text" id="experience">
            <!-- إضافة حقل لتحميل صور الخدمات السابقة -->
            <label for="previousServices">صور الخدمات السابقة:</label>
            <input type="file" accept="image/*" multiple id="previousServices">
            <button id="saveChanges">حفظ التغييرات</button>
        </section>
        <a href="#" id="logout">تسجيل الخروج</a>
    </main>
    <footer>
        <p>&copy; ٢٠٢٤ خدمات البناء</p>
    </footer>

    <!-- Firebase SDK Script Tags -->
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);

        const auth = firebase.auth();
        const firestore = firebase.firestore();

        // Get current user
        const currentUser = auth.currentUser;

        // Set user's profile data
        document.getElementById('name').value = currentUser.displayName || '';
        document.getElementById('email').value = currentUser.email || '';

        // Save changes button click event
        document.getElementById('saveChanges').addEventListener('click', () => {
            const name = document.getElementById('name').value;
            const nationality = document.getElementById('nationality').value;
            const city = document.getElementById('city').value;
            const experience = document.getElementById('experience').value;
            const image = document.getElementById('imageUpload').files[0];

            // Update user's display name and additional data
            currentUser.updateProfile({
                displayName: name,
                nationality: nationality,
                city: city,
                experience: experience
            }).then(() => {
                console.log("User profile updated successfully");

                // Upload image to storage (if provided)
                if (image) {
                    const storageRef = firebase.storage().ref();
                    const imageRef = storageRef.child(`profileImages/${currentUser.uid}/${image.name}`);

                    imageRef.put(image).then((snapshot) => {
                        console.log('Uploaded a blob or file!', snapshot);
                        snapshot.ref.getDownloadURL().then((downloadURL) => {
                            console.log('File available at', downloadURL);
                            // Update user's profile image URL
                            currentUser.updateProfile({
                                photoURL: downloadURL
                            }).then(() => {
                                console.log("User profile image URL updated successfully");
                                document.getElementById('profileImage').src = downloadURL;
                            }).catch((error) => {
                                console.error("Error updating user profile image URL:", error);
                            });
                        }).catch((error) => {
                            console.error("Error getting download URL:", error);
                        });
                    }).catch((error) => {
                        console.error("Error uploading image:", error);
                    });
                }
            }).catch((error) => {
                console.error("Error updating user profile:", error);
            });
        });

        // Logout button click event
        document.getElementById('logout').addEventListener('click', () => {
            auth.signOut().then(() => {
                // Sign-out successful
                console.log("User signed out successfully");
                window.location.href = 'login.html';
            }).catch((error) => {
                // An error happened
                console.error("Error signing out:", error);
            });
        });
    </script>
</body>
</html>
