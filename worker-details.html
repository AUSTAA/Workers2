<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل العمال</title>
    <link rel="stylesheet" href="profile.css">
    <style>
        /* أسلوب التنسيق هنا */
        body {
            font-family: Arial, sans-serif;
        }
        header, footer {
            background-color: #f8f8f8;
            padding: 10px 20px;
            text-align: center;
        }
        main {
            padding: 20px;
        }
        .profile-section {
            margin-bottom: 20px;
        }
        #workerServiceImagesContainer {
            margin-top: 20px;
        }
        #workerServiceImagesContainer h2 {
            margin-bottom: 10px;
        }
        #workerServiceImagesContainer img {
            max-width: 100%;
            margin-bottom: 10px;
        }
    </style>
</head>
<body dir="rtl">
    <header>
        <h1>تفاصيل العمال</h1>
        <button id="homeButton">الصفحة الرئيسية</button>
    </header>
    <main>
        <div class="profile-section">
            <img id="workerProfilePicture" src="" alt="الصورة الشخصية">
            <h2>بيانات العامل</h2>
            <p id="workerName"></p>
            <p id="workerPhone"></p>
            <p id="workerNationality"></p>
            <p id="workerCity"></p>
            <p id="workerExperienceYears"></p>
            <p id="workerAge"></p>
            <p id="workerProfession"></p>
        </div>
        <div id="workerServiceImagesContainer">
            <h2>صور الخدمات</h2>
            <div id="workerServiceImages"></div>
        </div>
    </main>
    <footer>
        <p>&copy; ٢٠٢٤ خدمات البناء</p>
    </footer>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-storage-compat.js"></script>
    <script>
        // إعداد Firebase
        const firebaseConfig = {
  apiKey: "AIzaSyB7YJhtaefEPc9NMzhTBjQC06WmSEja0xc",
  authDomain: "omran-16f44.firebaseapp.com",
  databaseURL: "https://omran-16f44-default-rtdb.firebaseio.com",
  projectId: "omran-16f44",
  storageBucket: "omran-16f44.appspot.com",
  messagingSenderId: "598982209417",
  appId: "1:598982209417:web:dc9cbddd485a1ea52bbb58",
  measurementId: "G-PGZJ0T555G"
};
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // تحديد الـ ID من عنوان URL
        const workerId = getWorkerIdFromUrl(window.location.href);

        // دالة للحصول على الـ ID من عنوان URL
        function getWorkerIdFromUrl(url) {
            const queryString = url.split('?')[1];
            const params = new URLSearchParams(queryString);
            return params.get('id');
        }

        // جلب بيانات العامل باستخدام الـ ID
        db.collection("users").doc(workerId).get()
            .then((doc) => {
                if (doc.exists) {
                    const workerData = doc.data();
                    document.getElementById('workerName').textContent = `الاسم: ${workerData.username}`;
                    document.getElementById('workerPhone').textContent = `رقم الهاتف: ${workerData.phone}`;
                    document.getElementById('workerNationality').textContent = `الجنسية: ${workerData.nationality}`;
                    document.getElementById('workerCity').textContent = `المدينة: ${workerData.city}`;
                    document.getElementById('workerExperienceYears').textContent = `عدد سنين الخبرة: ${workerData.experienceYears}`;
                    document.getElementById('workerAge').textContent = `العمر: ${workerData.age}`;
                    document.getElementById('workerProfession').textContent = `المهنة: ${workerData.profession}`;

                    // تحميل الصورة الشخصية
                    const profilePictureRef = firebase.storage().ref().child(`users/${workerId}/profilePicture.jpg`);
                    profilePictureRef.getDownloadURL().then((url) => {
                        document.getElementById('workerProfilePicture').src = url;
                    }).catch((error) => {
                        console.error("Error getting profile picture:", error);
                    });

                    // تحميل صور الخدمات
                    const serviceImagesContainer = document.getElementById('workerServiceImages');
                    serviceImagesContainer.innerHTML = ''; // مسح المحتوى الحالي
                    const serviceImagesRef = firebase.storage().ref().child(`users/${workerId}/serviceImages`);
                    serviceImagesRef.listAll().then((serviceImagesSnapshot) => {
                        serviceImagesSnapshot.items.forEach((itemRef) => {
                            itemRef.getDownloadURL().then((imageUrl) => {
                                const img = document.createElement('img');
                                img.src = imageUrl;
                                img.alt = 'صورة خدمة';
                                serviceImagesContainer.appendChild(img);
                            }).catch((error) => {
                                console.error("Error getting service image:", error);
                            });
                        });
                    }).catch((error) => {
                        console.error("Error getting service images:", error);
                    });
                } else {
                    console.log("No such document!");
                }
            })
            .catch((error) => {
                console.error("Error getting document:", error);
            });
    </script>
</body>
</html>
